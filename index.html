<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-SOUNDING SYSTEM - PT. KALIMANTAN PRIMA PERSADA</title>
    <!-- Muat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Muat SignaturePad -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <!-- Muat jsPDF dan html2canvas untuk Ekspor PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Muat SheetJS untuk Export Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        .container-card {
            max-width: 1400px;
            margin: 1rem auto;
            padding: 1.5rem;
            background: white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }
        .header-box {
            background: linear-gradient(135deg, #374151 0%, #6b7280 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 15px -3px rgba(55, 65, 81, 0.3);
        }
        .gold-gradient {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
        }
        .form-label {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
            display: block;
            font-size: 0.9rem;
        }
        .input-field {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s ease;
            background: white;
        }
        .input-field:focus {
            border-color: #f59e0b;
            outline: none;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        /* --- STAGGERED GRID STYLES --- */
        .drill-grid-area {
            display: grid;
            grid-template-columns: 60px repeat(30, minmax(25px, 1fr)); 
            border-top: 1px solid #e5e7eb;
            overflow-x: auto;
            min-width: 100%;
            background-color: white;
            font-size: 0.55rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .grid-header-cell {
            padding: 0.4rem 0.2rem;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-weight: 600;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
        }
        .grid-header-cell:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
            background: linear-gradient(135deg, #e2e8f0 0%, #f1f5f9 100%);
        }

        .grid-row-header {
            padding: 0.4rem 0.2rem;
            text-align: center;
            font-weight: 700;
            background: linear-gradient(135deg, #e2e8f0 0%, #f1f5f9 100%);
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            left: 0;
            z-index: 20;
            font-size: 0.65rem;
        }

        .row-count-cell {
            padding: 0.4rem 0.2rem;
            text-align: center;
            font-weight: 600;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            left: 50px;
            z-index: 15;
            font-size: 0.6rem;
            color: #92400e;
        }

        .hole-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2px 0;
            height: 45px;
            border-bottom: 1px solid #f3f4f6;
            position: relative;
            transition: background-color 0.2s ease;
        }

        .hole-cell:hover {
            background-color: #f8fafc;
        }

        .staggered-row-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: center;
            justify-content: center;
        }

        [data-row-index="1"] .staggered-row-content,
        [data-row-index="3"] .staggered-row-content,
        [data-row-index="5"] .staggered-row-content,
        [data-row-index="7"] .staggered-row-content,
        [data-row-index="9"] .staggered-row-content,
        [data-row-index="11"] .staggered-row-content,
        [data-row-index="13"] .staggered-row-content,
        [data-row-index="15"] .staggered-row-content {
            transform: translateX(12px);
        }
        
        .hole-dot {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            line-height: 1;
            width: 22px;
            height: 22px;
            font-weight: 700;
            cursor: pointer;
        }
        .hole-dot:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
        }
        
        .hole-dot.status-D { 
            background: linear-gradient(135deg, #34d399 0%, #059669 100%);
            border: 2px solid #059669;
        }
        .hole-dot.status-W { 
            background: linear-gradient(135deg, #60a5fa 0%, #2563eb 100%);
            border: 2px solid #2563eb;
        }
        .hole-dot.status-C { 
            background: linear-gradient(135deg, #fca5a5 0%, #ef4444 100%);
            border: 2px solid #ef4444;
        }
        
        .hole-modal {
            position: fixed;
            z-index: 100;
            background: white;
            border: 1px solid #ccc;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
            padding: 1.5rem;
            width: 280px;
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9) translateY(-10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Perbaikan Signature Pad Styles */
        .signature-container {
            position: relative;
            width: 100%;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        #signatureCanvas {
            width: 100% !important;
            height: 150px !important;
            display: block;
            cursor: crosshair;
            background: white;
            touch-action: none;
            border: 1px solid #e5e7eb;
        }

        .signature-clear-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            z-index: 10;
        }

        .signature-clear-btn:hover {
            background: rgba(220, 38, 38, 0.9);
        }

        .signature-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #9ca3af;
            font-style: italic;
            pointer-events: none;
            z-index: 1;
        }

        #pdfCaptureArea {
            background-color: white;
            padding: 12px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        /* PDF-specific styles */
        .pdf-optimized {
            width: 100% !important;
            max-width: 100% !important;
            overflow: hidden !important;
        }
        
        .pdf-drill-grid {
            grid-template-columns: 50px 40px repeat(30, minmax(15px, 1fr)) !important;
            font-size: 0.4rem !important;
        }
        
        /* PERBAIKAN: Font depth hole diperbesar */
        .pdf-hole-dot {
            width: 22px !important;
            height: 22px !important;
            font-size: 0.7rem !important;
            font-weight: 700 !important;
        }

        .pdf-hole-dot span {
            font-size: 0.7rem !important;
            font-weight: 700 !important;
        }

        .pdf-grid-header-cell {
            padding: 0.2rem 0.1rem !important;
            font-size: 0.4rem !important;
        }
        
        .pdf-grid-row-header {
            padding: 0.2rem 0.1rem !important;
            font-size: 0.45rem !important;
        }

        .pdf-row-count-cell {
            padding: 0.2rem 0.1rem !important;
            font-size: 0.4rem !important;
        }

        /* Optimasi tambahan untuk PDF */
        .pdf-optimized #pdfCaptureArea {
            padding: 15px !important;
            width: 1200px !important;
            max-width: 1200px !important;
        }

        .pdf-optimized .text-lg {
            font-size: 1.3rem !important;
        }

        .pdf-optimized .text-md {
            font-size: 1.1rem !important;
        }

        .pdf-optimized .text-sm {
            font-size: 1rem !important;
        }

        .pdf-optimized .text-xs {
            font-size: 0.9rem !important;
        }

        .share-link-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        /* Kompas Arah Mata Angin Styles */
        .compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .compass-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1e293b;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .compass-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .compass-base {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 2px solid #9ca3af;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .compass-center {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-radius: 50%;
            z-index: 10;
        }
        
        .compass-axis {
            position: absolute;
            background-color: #6b7280;
            border-radius: 2px;
        }
        
        .compass-axis-horizontal {
            width: 160px;
            height: 4px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .compass-axis-vertical {
            width: 4px;
            height: 160px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .compass-direction {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #6b7280;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 5;
            font-size: 0;
        }
        
        .compass-direction:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
        }
        
        .compass-direction.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.5);
            font-size: 1rem;
        }
        
        .compass-direction.active::after {
            content: "U";
        }
        
        .compass-direction.north {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .compass-direction.east {
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
        }
        
        .compass-direction.south {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .compass-direction.west {
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }

        /* Navigation Styles */
        .nav-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            font-weight: 600;
        }

        .nav-btn.active {
            border-color: #d97706;
            box-shadow: 0 10px 15px -3px rgba(217, 119, 6, 0.3);
            background: white !important;
            color: #92400e !important;
        }

        .content-section {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Premium card effects */
        .premium-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-radius: 12px;
            cursor: pointer;
        }

        .premium-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        }

        /* Import/Export Section */
        .import-export-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #cbd5e1;
            border-radius: 12px;
        }

        /* Database Styles */
        .database-grid {
            display: grid;
            grid-template-columns: 60px 50px repeat(30, minmax(25px, 1fr));
            border-top: 1px solid #e5e7eb;
            overflow-x: auto;
            min-width: 100%;
            background-color: white;
            font-size: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .database-grid .hole-dot {
            width: 20px;
            height: 20px;
            font-size: 0.45rem;
        }

        /* Hide elements for PDF */
        .screen-only {
            display: block;
        }
        
        .pdf-only {
            display: none;
        }
        
        @media print {
            .screen-only {
                display: none !important;
            }
            .pdf-only {
                display: block !important;
            }
        }

        /* Tombol Generate */
        .generate-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.4);
        }

        .generate-btn:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Login Modal Styles */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        .user-info {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        /* Kompas untuk PDF */
        .pdf-compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 8px;
            border: 1px solid #cbd5e1;
        }
        
        .pdf-compass-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .pdf-compass-base {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 2px solid #9ca3af;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pdf-compass-center {
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-radius: 50%;
            z-index: 10;
        }
        
        .pdf-compass-axis {
            position: absolute;
            background-color: #6b7280;
            border-radius: 2px;
        }
        
        .pdf-compass-axis-horizontal {
            width: 100px;
            height: 3px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .pdf-compass-axis-vertical {
            width: 3px;
            height: 100px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .pdf-compass-direction {
            position: absolute;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #6b7280;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.7rem;
            z-index: 5;
        }
        
        .pdf-compass-direction.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .pdf-compass-direction.north {
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .pdf-compass-direction.east {
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
        }
        
        .pdf-compass-direction.south {
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .pdf-compass-direction.west {
            top: 50%;
            left: 5px;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>

    <!-- PREMIUM HEADER WITH NAVIGATION -->
    <header class="bg-gradient-to-r from-gray-800 to-gray-600 text-white shadow-2xl mb-6 rounded-2xl overflow-hidden mx-4 mt-4">
        <div class="container mx-auto px-6 py-4">
            <!-- Main Header -->
            <div class="text-center mb-6">
                <h1 class="text-3xl md:text-4xl font-bold mb-2 tracking-tight">
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-gray-200 to-gray-100">
                        PT. KALIMANTAN PRIMA PERSADA
                    </span>
                </h1>
                <h2 class="text-xl md:text-2xl font-semibold text-gray-100">DISTRIK INDE - E-SOUNDING SYSTEM</h2>
                <p class="text-gray-200 mt-2 text-sm">Digital Blast Hole Monitoring & Reporting</p>
            </div>

            <!-- Navigation Menu -->
            <nav class="flex flex-wrap justify-center gap-3 mb-2" id="mainNavigation">
                <button data-section="home" class="nav-btn active px-5 py-3 bg-white text-gray-800 font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    üè† HOME
                </button>
                <button data-section="e-sounding" class="nav-btn px-5 py-3 bg-gray-700 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 hover:bg-gray-600">
                    üìä E-SOUNDING
                </button>
                <button data-section="preview" class="nav-btn px-5 py-3 bg-gray-700 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 hover:bg-gray-600">
                    üëÅÔ∏è PREVIEW
                </button>
                <button data-section="database" class="nav-btn px-5 py-3 bg-gray-700 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 hover:bg-gray-600">
                    üíæ DATABASE
                </button>
                <button id="loginBtn" class="px-5 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 hover:bg-blue-500">
                    üîê LOGIN
                </button>
            </nav>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="login-modal hidden">
        <div class="login-container">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Login Sistem</h2>
            <form id="loginForm">
                <div class="mb-4">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="input-field" placeholder="Masukkan username">
                </div>
                <div class="mb-6">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="input-field" placeholder="Masukkan password">
                </div>
                <div class="flex justify-between">
                    <button type="button" id="cancelLoginBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">
                        Batal
                    </button>
                    <button type="submit" class="px-4 py-2 gold-gradient text-white rounded-lg hover:shadow-lg transition">
                        Login
                    </button>
                </div>
            </form>
            <div class="mt-4 text-sm text-gray-600">
                <p class="font-semibold">Akun Demo:</p>
                <p>Admin: admin / admin123</p>
                <p>User: user / user123</p>
            </div>
        </div>
    </div>

    <div class="container-card">

        <!-- HOME SECTION -->
        <div id="homeSection" class="content-section">
            <div class="text-center py-8">
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-3xl p-8 shadow-2xl border border-gray-200">
                    <h1 class="text-4xl font-bold text-gray-900 mb-6">üöÄ WELCOME TO E-SOUNDING SYSTEM</h1>
                    <p class="text-xl text-gray-700 mb-8">Digital Solution for Blast Hole Monitoring & Reporting</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="premium-card p-6" onclick="showSection('e-sounding')">
                            <div class="text-4xl mb-4">üìä</div>
                            <h3 class="font-bold text-gray-800 mb-3 text-lg">E-SOUNDING</h3>
                            <p class="text-sm text-gray-600">Input data sounding dengan visualisasi grid interaktif dan import dari Excel</p>
                            <div class="mt-3 text-amber-600 font-semibold">Klik untuk mulai ‚Üí</div>
                        </div>
                        <div class="premium-card p-6" onclick="showSection('preview')">
                            <div class="text-4xl mb-4">üëÅÔ∏è</div>
                            <h3 class="font-bold text-gray-800 mb-3 text-lg">PREVIEW</h3>
                            <p class="text-sm text-gray-600">Lihat hasil visualisasi dan data historis dengan statistik lengkap</p>
                            <div class="mt-3 text-amber-600 font-semibold">Klik untuk melihat ‚Üí</div>
                        </div>
                        <div class="premium-card p-6 gold-gradient text-white" onclick="showSection('database')">
                            <div class="text-4xl mb-4">üíæ</div>
                            <h3 class="font-bold mb-3 text-lg">DATABASE</h3>
                            <p class="text-sm text-amber-100">Lihat dan kelola semua data sounding yang pernah diinput</p>
                            <div class="mt-3 text-amber-200 font-semibold">Klik untuk mengelola ‚Üí</div>
                        </div>
                    </div>
                    
                    <button data-section="e-sounding" class="nav-section-btn px-8 py-4 gold-gradient text-white font-bold rounded-2xl shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105 text-lg">
                        üöÄ START E-SOUNDING
                    </button>
                </div>
            </div>
        </div>

        <!-- E-SOUNDING SECTION -->
        <div id="e-soundingSection" class="content-section hidden">
            <!-- Section Informasi Umum dengan SHIFT -->
            <div id="generalInfoInputs" class="grid grid-cols-1 md:grid-cols-5 gap-4 p-6 mb-6 border border-gray-200 rounded-xl bg-gray-50">
                <div><label for="tanggal" class="form-label">Tanggal</label><input type="date" id="tanggal" class="input-field"></div>
                <div>
                    <label for="shift" class="form-label">SHIFT</label>
                    <select id="shift" class="input-field">
                        <option value="">Pilih Shift</option>
                        <option value="SHIFT 1">SHIFT 1</option>
                        <option value="SHIFT 2">SHIFT 2</option>
                    </select>
                </div>
                <div>
                    <label for="pit" class="form-label">PIT</label>
                    <select id="pit" class="input-field">
                        <option value="Tempudo 2">Tempudo 2</option>
                        <option value="Tempudo 3">Tempudo 3</option>
                        <option value="Tempudo 4">Tempudo 4</option>
                    </select>
                </div>
                <div><label for="lokasi" class="form-label">Lokasi</label><input type="text" id="lokasi" class="input-field" placeholder="Lokasi Blok"></div>
                <div><label for="planHole" class="form-label">Plan Hole</label><input type="number" id="planHole" class="input-field" placeholder="Jumlah Plan"></div>
                <div><label for="namaCrew" class="form-label">Nama Crew</label><input type="text" id="namaCrew" class="input-field" placeholder="Nama Crew"></div>
                <div><label for="namaGL" class="form-label">Nama GL</label><input type="text" id="namaGL" class="input-field" placeholder="Nama Group Leader"></div>
                <div><label for="burden" class="form-label">Burden (m)</label><input type="number" step="0.1" id="burden" class="input-field" placeholder="B"></div>
                <div><label for="spasi" class="form-label">Spasi (m)</label><input type="number" step="0.1" id="spasi" class="input-field" placeholder="S"></div>
                <div><label for="unitDrilling" class="form-label">Unit Drilling</label><input type="text" id="unitDrilling" class="input-field" placeholder="Unit"></div>
            </div>

            <!-- Arah Mata Angin dengan Kompas - DIREVISI -->
            <div class="compass-container">
                <div class="compass-title">Pilih Arah Utara dengan mengklik salah satu arah pada kompas:</div>
                
                <div class="compass-wrapper">
                    <!-- Garis horizontal -->
                    <div class="compass-axis compass-axis-horizontal"></div>
                    <!-- Garis vertikal -->
                    <div class="compass-axis compass-axis-vertical"></div>
                    
                    <!-- Lingkaran tengah -->
                    <div class="compass-base">
                        <div class="compass-center"></div>
                    </div>
                    
                    <!-- Arah-arah mata angin (kosong, akan muncul U saat dipilih) -->
                    <div class="compass-direction north" data-direction="utara"></div>
                    <div class="compass-direction east" data-direction="timur"></div>
                    <div class="compass-direction south" data-direction="selatan"></div>
                    <div class="compass-direction west" data-direction="barat"></div>
                </div>
                
                <!-- KETERANGAN ARAH UTARA DIHAPUS -->
            </div>

            <!-- IMPORT/EXPORT SECTION -->
            <div class="import-export-section p-6 mb-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800 text-center">üìä IMPORT/EXPORT DATA</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- IMPORT EXCEL -->
                    <div class="border border-amber-300 rounded-xl p-5 bg-amber-50">
                        <h4 class="font-bold mb-3 text-amber-800 text-lg">üì• IMPORT FROM EXCEL</h4>
                        <p class="text-sm text-gray-600 mb-4">Format: ID HOLE, DEPTH HOLE (m), HOLE CONDITION</p>
                        
                        <!-- TAMBAHAN: Tombol Hapus Semua Lubang -->
                        <div class="mb-4">
                            <button id="clearAllHolesBtn" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center justify-center font-semibold mb-2">
                                üóëÔ∏è HAPUS SEMUA DATA LUBANG
                            </button>
                            <p class="text-xs text-red-600 text-center">Klik untuk menghapus semua data lubang sebelum import</p>
                        </div>
                        
                        <input type="file" id="excelImport" accept=".xlsx,.xls" 
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100 mb-4" />
                        
                        <button id="importExcelBtn" class="w-full px-4 py-3 gold-gradient text-white rounded-lg hover:shadow-lg transition flex items-center justify-center font-semibold">
                            <span>üöÄ IMPORT & AUTO-FILL GRID</span>
                        </button>
                        
                        <div id="importPreview" class="mt-4 hidden">
                            <div class="text-sm font-semibold text-amber-700 mb-2">Preview Import:</div>
                            <div id="importPreviewContent" class="text-xs bg-white p-3 border rounded-lg mt-1 max-h-24 overflow-y-auto"></div>
                            <button id="confirmImportBtn" class="mt-3 w-full px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition font-semibold">
                                ‚úÖ Konfirmasi Import Data
                            </button>
                        </div>
                    </div>

                    <!-- EXPORT EXCEL -->
                    <div class="border border-gray-300 rounded-xl p-5 bg-gray-50">
                        <h4 class="font-bold mb-3 text-gray-800 text-lg">üì§ EXPORT TO EXCEL</h4>
                        <p class="text-sm text-gray-600 mb-4">Download template atau export data existing</p>
                        
                        <div class="grid grid-cols-1 gap-3">
                            <button id="downloadTemplateBtn" class="w-full px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition font-semibold">
                                üìã Download Template Excel
                            </button>
                            <button id="exportExcelBtn" class="w-full px-4 py-3 gold-gradient text-white rounded-lg hover:shadow-lg transition font-semibold">
                                üíæ Export Data ke Excel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Share Link Section -->
            <div id="shareLinkContainer" class="share-link-container hidden">
                <h3 class="font-bold text-lg mb-2 text-gray-800">üîó Link untuk Melanjutkan Pekerjaan</h3>
                <p class="text-sm text-gray-600 mb-2">Simpan link ini untuk melanjutkan pekerjaan di shift berikutnya:</p>
                <div class="flex gap-2">
                    <input type="text" id="shareableLink" class="input-field flex-1" readonly>
                    <button id="copyShareLinkBtn" class="px-4 py-2 gold-gradient text-white rounded-lg hover:shadow-lg transition">
                        Salin Link
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2">Link ini akan menyimpan semua data yang sudah diinput</p>
            </div>

            <!-- Notifikasi & User ID -->
            <div id="notification" class="hidden p-3 mb-4 rounded-lg text-sm" role="alert"></div>
            <div class="mb-4 text-sm text-gray-600">
                User ID (untuk sinkronisasi): <span id="userIdDisplay" class="font-mono bg-gray-100 p-1 rounded">...</span>
                <button id="generateShareLinkBtn" class="ml-4 px-3 py-1 gold-gradient text-white text-sm rounded hover:shadow-lg transition">
                    üîó Buat Link Share
                </button>
            </div>

            <!-- Container Khusus untuk Konten yang akan Di-Capture ke PDF -->
            <div id="pdfCaptureArea" class="bg-white pdf-optimized">

                <!-- Title yang muncul di PDF -->
                 <div class="text-center mb-4">
                    <h1 class="text-lg font-bold mb-1 text-gray-800">PT. KALIMANTAN PRIMA PERSADA - DISTRIK INDE</h1>
                    <h2 class="text-md font-semibold text-gray-700">PEMERIKSAAN KONDISI & KEDALAMAN LUBANG TEMBAK</h2>
                </div>

                <!-- Ringkasan Data Umum (Untuk PDF) -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-1 mb-3 text-xs p-2 border border-gray-300 rounded-lg">
                    <div><span class="font-semibold">Tanggal:</span> <span id="report_tanggal" class="font-medium"></span></div>
                    <div><span class="font-semibold">Shift:</span> <span id="report_shift" class="font-medium"></span></div>
                    <div><span class="font-semibold">PIT:</span> <span id="report_pit" class="font-medium"></span></div>
                    <div><span class="font-semibold">Lokasi:</span> <span id="report_lokasi" class="font-medium"></span></div>
                    <div><span class="font-semibold">Plan Hole:</span> <span id="report_planHole" class="font-medium"></span></div>
                    <div><span class="font-semibold">B x S:</span> <span id="report_geometri" class="font-medium"></span></div>
                    <div><span class="font-semibold">Unit:</span> <span id="report_unit" class="font-medium"></span></div>
                    <div><span class="font-semibold">Arah Utara:</span> <span id="report_north_direction" class="font-medium"></span></div>
                </div>

                <!-- Kompas untuk PDF - DIPERBAIKI -->
                <div id="pdfCompassContainer" class="pdf-compass-container">
                    <div class="text-xs font-semibold mb-1">Diagram Arah Utara:</div>
                    <div class="pdf-compass-wrapper">
                        <div class="pdf-compass-axis pdf-compass-axis-horizontal"></div>
                        <div class="pdf-compass-axis pdf-compass-axis-vertical"></div>
                        <div class="pdf-compass-base">
                            <div class="pdf-compass-center"></div>
                        </div>
                        <div class="pdf-compass-direction north" id="pdfNorth"></div>
                        <div class="pdf-compass-direction east" id="pdfEast"></div>
                        <div class="pdf-compass-direction south" id="pdfSouth"></div>
                        <div class="pdf-compass-direction west" id="pdfWest"></div>
                    </div>
                </div>

                <!-- Section Grid Pemeriksaan Lubang -->
                <div class="overflow-x-auto mb-6">
                    <h3 class="text-md font-bold mb-1 text-gray-700">Visualisasi Kondisi Lubang (Staggered Pattern)</h3>
                    <div id="drillGrid" class="drill-grid-area bg-white rounded-lg border border-gray-300 pdf-drill-grid">
                        <!-- Grid akan di-generate di sini oleh JavaScript -->
                    </div>
                </div>

                <!-- Section Keterangan Ringkas & TTD - FIXED untuk PDF -->
                <div class="mt-6 flex justify-between gap-4 border-t pt-3">
                    
                    <!-- Keterangan Status -->
                    <div class="w-1/3">
                        <h4 class="font-semibold mb-1 text-gray-700 text-sm">Keterangan Status:</h4>
                        <ul class="text-xs space-y-1">
                            <li class="flex items-center"><span class="hole-dot w-3 h-3 rounded-full status-D mr-2"></span> D: KERING (Ideal)</li>
                            <li class="flex items-center"><span class="hole-dot w-3 h-3 rounded-full status-W mr-2"></span> W: BASAH (Ada Air)</li>
                            <li class="flex items-center"><span class="hole-dot w-3 h-3 rounded-full status-C mr-2"></span> C: COLLAPSE</li> 
                        </ul>
                    </div>

                    <!-- Tanda Tangan Area - FIXED untuk PDF -->
                    <div class="w-1/3 text-center">
                        <h3 class="font-semibold mb-1 text-gray-700 text-sm">Tanda Tangan Pemeriksa:</h3>
                        <div class="w-full max-w-[120px] h-16 mx-auto border border-gray-400 bg-gray-100 flex items-center justify-center">
                            <img id="report_signature_img" class="max-w-full max-h-full" alt="Tanda Tangan Pemeriksa">
                        </div>
                        <p class="mt-1 text-xs font-medium" id="report_crew_name">(Nama Crew)</p>
                    </div>

                    <!-- Additional Info untuk PDF -->
                    <div class="w-1/3 text-center pdf-only">
                        <h3 class="font-semibold mb-1 text-gray-700 text-sm">Informasi Tambahan:</h3>
                        <div class="text-xs text-gray-600 space-y-1">
                            <p>Dokumen ini dibuat secara digital</p>
                            <p>PT. Kalimantan Prima Persada</p>
                            <p>Distrik Inde</p>
                        </div>
                    </div>
                </div>

                <!-- Ringkasan Data Copas (Hanya untuk screen, tidak untuk PDF) -->
                <div class="screen-only">
                    <h3 class="text-sm font-bold my-2 text-gray-800 border-t pt-3">Ringkasan Data untuk Mining Dispatch:</h3>
                    <pre id="report_summary_text" class="whitespace-pre-wrap p-2 bg-gray-100 border rounded text-xs font-mono"></pre>
                </div>

            </div> 
            <!-- END pdfCaptureArea -->


            <!-- Modal Pop-up untuk Input Lubang - DIPERBAIKI POSISI -->
            <div id="holeModal" class="hole-modal hidden">
                <h4 class="font-bold mb-3 text-lg text-gray-800" id="modalHoleId">Hole: A-1</h4>
                
                <div class="mb-4">
                    <label for="holeDepth" class="form-label text-sm">Kedalaman (m):</label>
                    <input type="number" step="0.1" id="holeDepth" class="input-field" placeholder="0.0">
                </div>

                <div class="mb-4">
                    <label for="holeCondition" class="form-label text-sm">Kondisi Lubang:</label>
                    <select id="holeCondition" class="input-field">
                        <option value="">Pilih Kondisi</option>
                        <option value="Kering">Kering</option>
                        <option value="Basah">Basah</option>
                        <option value="Collapse">Collapse</option>
                    </select>
                </div>

                <div class="flex space-x-2">
                    <button id="saveHoleDataBtn" class="flex-1 px-3 py-2 gold-gradient text-white text-sm font-semibold rounded-lg hover:shadow-lg transition duration-200">
                        Simpan
                    </button>
                    <button id="closeHoleModalBtn" class="flex-1 px-3 py-2 bg-gray-300 text-gray-800 text-sm font-semibold rounded-lg hover:bg-gray-400 transition duration-200">
                        Batal
                    </button>
                </div>
            </div>

            <!-- Section Tanda Tangan (Screen Only) - IMPROVED -->
            <div class="mt-8 border-t pt-6">
                <h3 class="text-lg font-bold mb-4 text-gray-700">Tanda Tangan (TTD) - Pemeriksa</h3>
                
                <div class="signature-container">
                    <canvas id="signatureCanvas"></canvas>
                    <div class="signature-placeholder" id="signaturePlaceholder">
                        Gambar tanda tangan di area ini menggunakan mouse/touch...
                    </div>
                    <button class="signature-clear-btn" id="clearSignatureBtnSmall">
                        Hapus
                    </button>
                </div>
                
                <div class="flex space-x-4 mt-4">
                    <button id="clearSignatureBtn" class="flex-1 px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition duration-200">
                        Hapus TTD
                    </button>
                    <button id="saveDataBtn" class="flex-1 px-4 py-2 gold-gradient text-white font-semibold rounded-lg hover:shadow-lg transition duration-200">
                        Simpan Data
                    </button>
                </div>
            </div>

            <!-- Section for Report Generation and Copying (Screen Only) -->
            <div class="mt-8 pt-6 border-t">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <button id="generatePdfBtn" class="w-full px-4 py-3 gold-gradient text-white font-bold rounded-lg hover:shadow-lg transition duration-200 shadow-md">
                        üìÑ DOWNLOAD PDF (LANDSCAPE)
                    </button>
                    <button id="exportExcelBtn2" class="w-full px-4 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition duration-200 shadow-md">
                        üìä EXPORT EXCEL
                    </button>
                    <button id="generateFinalReportBtn" class="w-full px-4 py-3 generate-btn transition duration-200 shadow-md">
                        üöÄ GENERATE & SIMPAN KE DATABASE
                    </button>
                </div>

                <!-- Database Sync Section -->
                <div class="mt-6 p-4 bg-blue-50 border border-blue-300 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-gray-800">üîÑ Sinkronisasi Database</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="syncDatabaseBtn" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
                            üîÑ Sync dengan Database Server
                        </button>
                        <button id="exportDatabaseBtn" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold">
                            üíæ Export Database ke File
                        </button>
                    </div>
                    <div id="syncStatus" class="mt-2 text-sm text-gray-600"></div>
                </div>

                <!-- Copy Paste Output -->
                <div id="copyOutputContainer" class="hidden mt-6 p-4 bg-amber-50 border border-amber-300 rounded-lg">
                    <h4 class="font-bold text-lg mb-2 text-gray-800">Format Data untuk Salin (Copas)</h4>
                    <textarea id="copyOutputText" class="w-full h-40 font-mono text-sm p-2 border rounded resize-none bg-white" readonly></textarea>
                    <button id="copyToClipboardBtn" class="mt-2 px-3 py-1 gold-gradient text-white text-sm rounded hover:shadow-lg transition">
                        Salin ke Clipboard
                    </button>
                    <p class="text-xs text-amber-600 mt-2">Gunakan teks ini untuk Mining Dispatch atau grup WA.</p>
                </div>
            </div>
        </div>

        <!-- PREVIEW SECTION -->
        <div id="previewSection" class="content-section hidden">
            <div class="bg-white rounded-2xl p-8 shadow-2xl border border-gray-200">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">üëÅÔ∏è DATA PREVIEW</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Recent Reports -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üìã Data Saat Ini</h3>
                        <div id="currentData" class="space-y-3">
                            <div class="bg-white rounded-xl p-4 shadow border border-gray-200">
                                <div class="text-sm text-gray-600">Isi data di section E-SOUNDING untuk melihat preview</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics -->
                    <div class="bg-amber-50 rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-amber-800 mb-4">üìà Statistik</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Total Lubang:</span>
                                <span class="font-bold text-gray-700" id="statTotalHoles">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Rata-rata Kedalaman:</span>
                                <span class="font-bold text-amber-700" id="statAvgDepth">0.0 m</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Kondisi Kering:</span>
                                <span class="font-bold text-green-700" id="statDryPercentage">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DATABASE SECTION -->
        <div id="databaseSection" class="content-section hidden">
            <div class="bg-white rounded-2xl p-8 shadow-2xl border border-gray-200">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">üíæ DATABASE TERPUSAT</h2>
                
                <!-- Database Info & Controls -->
                <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl">
                    <h3 class="text-xl font-bold mb-4 text-blue-800 text-center">üìä Database Terpusat - Diakses Semua User</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button id="syncDatabaseBtn2" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
                            üîÑ Refresh Database
                        </button>
                        <button id="importDatabaseFileBtn" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold">
                            üì• Import dari File
                        </button>
                        <button id="clearLocalDatabaseBtn" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold">
                            üóëÔ∏è Hapus Data Lokal
                        </button>
                    </div>
                    <div id="databaseSyncStatus" class="mt-3 text-center text-sm text-blue-700 font-medium"></div>
                </div>

                <!-- User Info & Logout -->
                <div id="userInfoSection" class="user-info hidden">
                    <div>
                        <span id="userRoleDisplay" class="font-semibold"></span>
                        <span id="userNameDisplay" class="text-gray-600 ml-2"></span>
                    </div>
                    <button id="logoutBtn" class="logout-btn">
                        Logout
                    </button>
                </div>
                
                <!-- Database Import Section (Admin Only) -->
                <div id="adminOnlySection" class="import-export-section p-6 mb-6 hidden">
                    <h3 class="text-xl font-bold mb-4 text-gray-800 text-center">üì• IMPORT DATABASE EXCEL</h3>
                    <div class="border border-amber-300 rounded-xl p-5 bg-amber-50">
                        <p class="text-sm text-gray-600 mb-4">Import file Excel berisi multiple data sounding sekaligus</p>
                        <input type="file" id="databaseExcelImport" accept=".xlsx,.xls" 
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100 mb-4" />
                        <button id="importDatabaseBtn" class="w-full px-4 py-3 gold-gradient text-white rounded-lg hover:shadow-lg transition font-semibold">
                            üöÄ IMPORT DATABASE
                        </button>
                    </div>
                </div>

                <!-- Database Results -->
                <div id="dbResults" class="space-y-6">
                    <div class="text-center p-8 bg-gray-50 rounded-xl">
                        <div class="text-4xl mb-4">üìä</div>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">Database Terpusat</h3>
                        <p class="text-gray-600">Data akan ditampilkan di sini setelah sinkronisasi</p>
                        <p class="text-sm text-gray-500 mt-2">Klik "Refresh Database" untuk memuat data terbaru</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- SIMPLE NAVIGATION SCRIPT -->
    <script>
    // Simple Navigation System
    document.addEventListener('DOMContentLoaded', function() {
        // Navigation buttons
        const navButtons = document.querySelectorAll('.nav-btn, .nav-section-btn');
        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                const sectionName = this.getAttribute('data-section');
                if (sectionName) {
                    showSection(sectionName);
                }
            });
        });

        // Home section cards clickable
        const homeCards = document.querySelectorAll('.premium-card');
        homeCards.forEach(card => {
            card.addEventListener('click', function() {
                const targetSection = this.getAttribute('onclick');
                if (targetSection) {
                    // Extract section name from onclick attribute
                    const sectionName = targetSection.replace("showSection('", "").replace("')", "");
                    showSection(sectionName);
                }
            });
        });

        // Show home section by default
        showSection('home');
    });

    function showSection(sectionName) {
        console.log('Showing section:', sectionName);
        
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.add('hidden');
        });
        
        // Remove active class from all buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active', 'bg-white', 'text-gray-800');
            btn.classList.add('bg-gray-700', 'text-white');
        });
        
        // Show target section
        const targetSection = document.getElementById(sectionName + 'Section');
        if (targetSection) {
            targetSection.classList.remove('hidden');
        }
        
        // Activate corresponding button
        const activeButton = document.querySelector(`[data-section="${sectionName}"]`);
        if (activeButton) {
            activeButton.classList.remove('bg-gray-700', 'text-white');
            activeButton.classList.add('active', 'bg-white', 'text-gray-800');
        }

        // Load database data if showing database section
        if (sectionName === 'database') {
            loadDatabaseData();
        }
    }

    // Make function globally available
    window.showSection = showSection;
    </script>

    <!-- MAIN APPLICATION SCRIPT -->
    <script>
    // Global variables
    let signaturePad;
    let currentHoleId = null;
    let currentNorthDirection = null;
    let holeData = {};
    let importData = null;
    let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');

    // Hole Grid Configuration
    const HOLE_ROWS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O'];
    const MAX_COLUMNS = 30;

    // User credentials
    const USERS = {
        'admin': { password: 'admin123', role: 'admin', name: 'Administrator' },
        'user': { password: 'user123', role: 'user', name: 'Regular User' }
    };

    // ==================== DATABASE TERPUSAT DENGAN LOCALSTORAGE SHARED ====================

    const SHARED_DATABASE_KEY = 'sounding_shared_database';
    const DATABASE_CONFIG = {
        useShared: true,
        fileName: 'sounding_database.json'
    };

    // Fungsi untuk menyimpan ke database terpusat (shared localStorage)
    function saveToSharedDatabase(report) {
        try {
            // Ambil database yang ada
            const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
            
            // Inisialisasi jika belum ada
            if (!sharedDb.reports) {
                sharedDb.reports = [];
                sharedDb.metadata = {
                    created: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    totalReports: 0
                };
            }
            
            // Cek apakah report sudah ada (update)
            const existingIndex = sharedDb.reports.findIndex(r => r.id === report.id);
            if (existingIndex !== -1) {
                sharedDb.reports[existingIndex] = report;
            } else {
                // Tambah report baru
                sharedDb.reports.push(report);
            }
            
            // Update metadata
            sharedDb.metadata.lastUpdated = new Date().toISOString();
            sharedDb.metadata.totalReports = sharedDb.reports.length;
            
            // Simpan ke localStorage
            localStorage.setItem(SHARED_DATABASE_KEY, JSON.stringify(sharedDb));
            
            console.log('Data berhasil disimpan ke database terpusat');
            return true;
            
        } catch (error) {
            console.error('Gagal menyimpan ke database terpusat:', error);
            return false;
        }
    }

    // Fungsi untuk mengambil semua data dari database terpusat
    function loadFromSharedDatabase() {
        try {
            const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
            return sharedDb.reports || [];
        } catch (error) {
            console.error('Gagal mengambil data dari database terpusat:', error);
            return [];
        }
    }

    // Fungsi untuk sinkronisasi database lokal dengan database terpusat
    function syncWithSharedDatabase() {
        try {
            // 1. Ambil data dari database terpusat
            const sharedData = loadFromSharedDatabase();
            
            // 2. Ambil data lokal
            const localData = JSON.parse(localStorage.getItem('allSoundingReports') || '[]');
            
            // 3. Merge data (prioritaskan data terpusat untuk menghindari konflik)
            const mergedData = mergeDatabases(sharedData, localData);
            
            // 4. Simpan data yang sudah di-merge ke kedua database
            localStorage.setItem('allSoundingReports', JSON.stringify(mergedData));
            
            // Update database terpusat dengan data merged
            const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
            sharedDb.reports = mergedData;
            sharedDb.metadata = {
                ...sharedDb.metadata,
                lastUpdated: new Date().toISOString(),
                totalReports: mergedData.length
            };
            localStorage.setItem(SHARED_DATABASE_KEY, JSON.stringify(sharedDb));
            
            console.log('Sinkronisasi berhasil. Total data:', mergedData.length);
            return mergedData;
            
        } catch (error) {
            console.error('Sinkronisasi gagal:', error);
            return null;
        }
    }

    // Fungsi untuk merge database
    function mergeDatabases(sharedData, localData) {
        const mergedMap = new Map();
        
        // Prioritaskan data dari database terpusat
        sharedData.forEach(report => {
            if (report && report.id) {
                mergedMap.set(report.id, report);
            }
        });
        
        // Tambahkan data lokal yang belum ada di database terpusat
        localData.forEach(report => {
            if (report && report.id && !mergedMap.has(report.id)) {
                mergedMap.set(report.id, report);
            }
        });
        
        return Array.from(mergedMap.values());
    }

    // ==================== TAMPILAN DATABASE UNTUK SEMUA USER ====================

    // Fungsi untuk menampilkan database terpusat di section database
    function loadSharedDatabaseData() {
        const sharedData = loadFromSharedDatabase();
        const dbResults = document.getElementById('dbResults');
        
        if (sharedData.length === 0) {
            dbResults.innerHTML = `
                <div class="text-center p-8 bg-gray-50 rounded-xl">
                    <div class="text-4xl mb-4">üìä</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">Database Masih Kosong</h3>
                    <p class="text-gray-600">Belum ada data yang disimpan di database terpusat.</p>
                    <p class="text-sm text-gray-500 mt-2">Buat laporan di section E-SOUNDING untuk mulai mengisi database.</p>
                </div>
            `;
            return;
        }

        let html = '';
        
        // Tampilkan info database
        const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
        const metadata = sharedDb.metadata || {};
        
        html += `
            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-blue-600">${sharedData.length}</div>
                        <div class="text-sm text-blue-800">Total Laporan</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-600">${getUniqueValues(sharedData, 'pit').length}</div>
                        <div class="text-sm text-green-800">Jumlah PIT</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600">${getUniqueValues(sharedData, 'lokasi').length}</div>
                        <div class="text-sm text-purple-800">Lokasi Berbeda</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-amber-600">${formatDate(metadata.lastUpdated)}</div>
                        <div class="text-sm text-amber-800">Update Terakhir</div>
                    </div>
                </div>
            </div>
        `;

        // Sort reports by timestamp (newest first)
        sharedData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        // Filter dan search
        html += `
            <div class="bg-white border border-gray-200 rounded-xl p-4 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="form-label text-sm">Cari berdasarkan Lokasi/Nama:</label>
                        <input type="text" id="searchDatabase" placeholder="Cari..." 
                               class="input-field text-sm" onkeyup="filterDatabase()">
                    </div>
                    <div>
                        <label class="form-label text-sm">Filter berdasarkan PIT:</label>
                        <select id="filterPit" class="input-field text-sm" onchange="filterDatabase()">
                            <option value="">Semua PIT</option>
                            <option value="Tempudo 2">Tempudo 2</option>
                            <option value="Tempudo 3">Tempudo 3</option>
                            <option value="Tempudo 4">Tempudo 4</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label text-sm">Filter berdasarkan Shift:</label>
                        <select id="filterShift" class="input-field text-sm" onchange="filterDatabase()">
                            <option value="">Semua Shift</option>
                            <option value="SHIFT 1">SHIFT 1</option>
                            <option value="SHIFT 2">SHIFT 2</option>
                        </select>
                    </div>
                </div>
            </div>
        `;

        // Data reports
        html += `<div id="databaseResultsContainer">`;
        
        sharedData.forEach((report, index) => {
            const stats = report.statistics || calculateStatisticsFromReport(report);
            
            html += `
                <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow database-item" 
                     data-lokasi="${report.lokasi || ''}" 
                     data-pit="${report.pit || ''}" 
                     data-shift="${report.shift || ''}"
                     data-crew="${report.namaCrew || ''}">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="font-bold text-lg text-gray-800">${report.lokasi || 'Unknown Location'}</h3>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded">${report.pit || 'No PIT'}</span>
                                <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-semibold rounded">${report.shift || 'No Shift'}</span>
                            </div>
                            <p class="text-sm text-gray-600">
                                üìÖ ${report.tanggal} | 
                                üë∑ ${report.namaCrew || 'No Crew'} | 
                                üèóÔ∏è ${report.namaGL || 'No GL'}
                            </p>
                            <p class="text-xs text-gray-500 mt-1">
                                Dibuat oleh: <span class="font-semibold">${report.createdBy || 'unknown'}</span> | 
                                ${new Date(report.timestamp).toLocaleString()}
                            </p>
                        </div>
                        <span class="px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-semibold whitespace-nowrap">
                            ${stats.totalHoles} Lubang
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm">
                        <div class="text-center">
                            <div class="text-gray-600">Plan Hole</div>
                            <div class="font-semibold text-lg">${report.planHole || '-'}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-600">B x S</div>
                            <div class="font-semibold">${report.burden || '-'} x ${report.spasi || '-'}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-600">Kedalaman</div>
                            <div class="font-semibold text-amber-700">${stats.avgDepth} m</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-600">Kondisi Kering</div>
                            <div class="font-semibold text-green-600">${stats.dryPercentage}%</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                        <div class="text-sm text-gray-500">
                            <span class="font-semibold">Arah Utara:</span> ${report.northDirection ? report.northDirection.toUpperCase() : 'Tidak ada'}
                        </div>
                        <div class="space-x-2">
                            <button onclick="loadReportToForm('${report.id}')" 
                                    class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition flex items-center gap-1">
                                <span>üìã</span> Load
                            </button>
                            <button onclick="viewReportGrid('${report.id}')" 
                                    class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 transition flex items-center gap-1">
                                <span>üëÅÔ∏è</span> View Grid
                            </button>
                            <button onclick="downloadReportPDF('${report.id}')" 
                                    class="px-3 py-1 bg-purple-500 text-white text-sm rounded hover:bg-purple-600 transition flex items-center gap-1">
                                <span>üìÑ</span> PDF
                            </button>
                            ${currentUser && currentUser.role === 'admin' ? `
                            <button onclick="deleteReport('${report.id}')" 
                                    class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition flex items-center gap-1">
                                <span>üóëÔ∏è</span> Hapus
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `</div>`;
        
        dbResults.innerHTML = html;
    }

    // Fungsi untuk filter database
    function filterDatabase() {
        const searchTerm = document.getElementById('searchDatabase').value.toLowerCase();
        const pitFilter = document.getElementById('filterPit').value;
        const shiftFilter = document.getElementById('filterShift').value;
        
        const items = document.querySelectorAll('.database-item');
        
        items.forEach(item => {
            const lokasi = item.getAttribute('data-lokasi').toLowerCase();
            const pit = item.getAttribute('data-pit');
            const shift = item.getAttribute('data-shift');
            const crew = item.getAttribute('data-crew').toLowerCase();
            
            const matchesSearch = !searchTerm || 
                                lokasi.includes(searchTerm) || 
                                crew.includes(searchTerm);
            
            const matchesPit = !pitFilter || pit === pitFilter;
            const matchesShift = !shiftFilter || shift === shiftFilter;
            
            if (matchesSearch && matchesPit && matchesShift) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Helper functions
    function getUniqueValues(data, key) {
        const values = data.map(item => item[key]).filter(Boolean);
        return [...new Set(values)];
    }

    function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        return date.toLocaleDateString('id-ID') + ' ' + date.toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'});
    }

    // ==================== INTEGRASI KE SYSTEM YANG ADA ====================

    // Ganti fungsi saveReportToDatabase
    function saveReportToDatabase() {
        const signatureBase64 = signaturePad && !signaturePad.isEmpty() ? signaturePad.toDataURL() : '';
        
        const report = {
            id: 'report_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            pit: document.getElementById('pit').value,
            shift: document.getElementById('shift').value,
            lokasi: document.getElementById('lokasi').value,
            tanggal: document.getElementById('tanggal').value,
            planHole: document.getElementById('planHole').value,
            namaCrew: document.getElementById('namaCrew').value,
            namaGL: document.getElementById('namaGL').value,
            burden: document.getElementById('burden').value,
            spasi: document.getElementById('spasi').value,
            unitDrilling: document.getElementById('unitDrilling').value,
            holeData: {...holeData},
            signatureBase64: signatureBase64,
            northDirection: currentNorthDirection,
            timestamp: new Date().toISOString(),
            statistics: calculateStatistics(),
            createdBy: currentUser ? currentUser.username : 'anonymous'
        };
        
        // 1. Simpan ke localStorage (backup)
        let allReports = JSON.parse(localStorage.getItem('allSoundingReports') || '[]');
        allReports.push(report);
        localStorage.setItem('allSoundingReports', JSON.stringify(allReports));
        
        // 2. Simpan ke database terpusat
        saveToSharedDatabase(report);
        
        console.log("Report saved to both local and shared database:", report.id);
        
        return report.id;
    }

    // Ganti fungsi syncDatabase
    function syncDatabase() {
        showNotification("Menyinkronisasi database terpusat...", false);
        updateSyncStatus("üîÑ Menyinkronisasi database...");

        try {
            const syncedData = syncWithSharedDatabase();
            
            if (syncedData) {
                updateSyncStatus(`‚úÖ Database tersinkronisasi! Total: ${syncedData.length} laporan`);
                showNotification(`Database berhasil disinkronisasi! Total: ${syncedData.length} laporan`);
                
                // Refresh tampilan database
                if (!document.getElementById('databaseSection').classList.contains('hidden')) {
                    loadSharedDatabaseData();
                }
            }
            
        } catch (error) {
            console.error('Sync error:', error);
            updateSyncStatus("‚ùå Gagal sinkronisasi");
            showNotification("Gagal menyinkronisasi database", true);
        }
    }

    // Ganti fungsi loadDatabaseData di section database
    function loadDatabaseData() {
        // Selalu gunakan database terpusat untuk tampilan
        loadSharedDatabaseData();
    }

    // Ganti fungsi deleteReport untuk menghapus dari database terpusat
    function deleteReport(reportId) {
        if (!currentUser || currentUser.role !== 'admin') {
            showNotification("Anda tidak memiliki akses untuk menghapus laporan", true);
            return;
        }
        
        if (confirm('Apakah Anda yakin ingin menghapus laporan ini dari database terpusat?')) {
            try {
                // Hapus dari database terpusat
                const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
                if (sharedDb.reports) {
                    sharedDb.reports = sharedDb.reports.filter(report => report.id !== reportId);
                    sharedDb.metadata.totalReports = sharedDb.reports.length;
                    sharedDb.metadata.lastUpdated = new Date().toISOString();
                    localStorage.setItem(SHARED_DATABASE_KEY, JSON.stringify(sharedDb));
                }
                
                // Hapus dari localStorage (opsional)
                const localData = JSON.parse(localStorage.getItem('allSoundingReports') || '[]');
                const updatedLocalData = localData.filter(report => report.id !== reportId);
                localStorage.setItem('allSoundingReports', JSON.stringify(updatedLocalData));
                
                showNotification("Laporan berhasil dihapus dari database terpusat");
                loadSharedDatabaseData();
                
            } catch (error) {
                showNotification("Gagal menghapus laporan: " + error.message, true);
            }
        }
    }

    // Ganti fungsi loadReportToForm untuk mencari dari database terpusat
    function loadReportToForm(reportId) {
        const sharedData = loadFromSharedDatabase();
        const report = sharedData.find(r => r.id === reportId);
        
        if (!report) {
            // Fallback ke localStorage
            const allReports = JSON.parse(localStorage.getItem('allSoundingReports') || '[]');
            const localReport = allReports.find(r => r.id === reportId);
            if (!localReport) {
                showNotification("Laporan tidak ditemukan", true);
                return;
            }
            loadReportData(localReport);
        } else {
            loadReportData(report);
        }
    }

    function loadReportData(report) {
        // Load form data
        document.getElementById('pit').value = report.pit || '';
        document.getElementById('shift').value = report.shift || '';
        document.getElementById('lokasi').value = report.lokasi || '';
        document.getElementById('tanggal').value = report.tanggal || '';
        document.getElementById('planHole').value = report.planHole || '';
        document.getElementById('namaCrew').value = report.namaCrew || '';
        document.getElementById('namaGL').value = report.namaGL || '';
        document.getElementById('burden').value = report.burden || '';
        document.getElementById('spasi').value = report.spasi || '';
        document.getElementById('unitDrilling').value = report.unitDrilling || '';
        
        // Load hole data
        holeData = {...report.holeData};
        
        // Update ALL hole dots
        HOLE_ROWS.forEach(row => {
            for (let col = 1; col <= MAX_COLUMNS; col++) {
                const holeId = `${row}-${col}`;
                updateHoleDotUI(holeId);
            }
        });
        
        // Update row counters
        updateRowCounters();
        
        // Load signature
        if (report.signatureBase64 && signaturePad) {
            signaturePad.clear();
            const img = new Image();
            img.onload = function() {
                const ctx = signaturePad.canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, signaturePad.canvas.width, signaturePad.canvas.height);
                document.getElementById('signaturePlaceholder').style.display = 'none';
            };
            img.src = report.signatureBase64;
        }
        
        // Load north direction
        if (report.northDirection) {
            currentNorthDirection = report.northDirection;
            updatePdfCompass();
            const compassDirections = document.querySelectorAll('.compass-direction');
            compassDirections.forEach(dir => {
                dir.classList.remove('active');
                if (dir.getAttribute('data-direction') === currentNorthDirection) {
                    dir.classList.add('active');
                }
            });
        }
        
        saveSessionData();
        showSection('e-sounding');
        showNotification(`Laporan ${report.lokasi} berhasil dimuat dari database terpusat!`);
    }

    // ==================== INISIALISASI ====================

    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
        checkLoginStatus();
        
        // Inisialisasi database terpusat pertama kali
        setTimeout(() => {
            const sharedDb = JSON.parse(localStorage.getItem(SHARED_DATABASE_KEY) || '{}');
            if (!sharedDb.reports) {
                // Migrasi data lokal ke database terpusat jika ada
                const localData = JSON.parse(localStorage.getItem('allSoundingReports') || '[]');
                if (localData.length > 0) {
                    const sharedDb = {
                        reports: localData,
                        metadata: {
                            created: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            totalReports: localData.length
                        }
                    };
                    localStorage.setItem(SHARED_DATABASE_KEY, JSON.stringify(sharedDb));
                    console.log('Data lokal dimigrasikan ke database terpusat:', localData.length, 'laporan');
                }
            }
        }, 2000);
    });

    // ... (fungsi-fungsi lainnya tetap sama) ...

    // Update fungsi showSection untuk selalu sinkronisasi saat buka database
    function showSection(sectionName) {
        console.log('Showing section:', sectionName);
        
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.add('hidden');
        });
        
        // Remove active class from all buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active', 'bg-white', 'text-gray-800');
            btn.classList.add('bg-gray-700', 'text-white');
        });
        
        // Show target section
        const targetSection = document.getElementById(sectionName + 'Section');
        if (targetSection) {
            targetSection.classList.remove('hidden');
        }
        
        // Activate corresponding button
        const activeButton = document.querySelector(`[data-section="${sectionName}"]`);
        if (activeButton) {
            activeButton.classList.remove('bg-gray-700', 'text-white');
            activeButton.classList.add('active', 'bg-white', 'text-gray-800');
        }

        // Load database data if showing database section - SELALU SINKRONISASI
        if (sectionName === 'database') {
            syncDatabase(); // Sinkronisasi dulu
            setTimeout(() => {
                loadSharedDatabaseData(); // Kemudian tampilkan
            }, 500);
        }
    }

    // Make functions globally available
    window.loadReportToForm = loadReportToForm;
    window.viewReportGrid = viewReportGrid;
    window.deleteReport = deleteReport;
    window.closeGridModal = closeGridModal;
    window.downloadReportPDF = downloadReportPDF;
    window.filterDatabase = filterDatabase;
    </script>

</body>
</html>
